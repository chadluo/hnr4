"use client";

import { experimental_useObject as useObject } from "@ai-sdk/react";
import * as React from "react";
import { messageSchema } from "./api/generate/schema";
import type { Flags } from "./flags";
import type { HNStory } from "./hn";
import { model } from "./model";

export type SummaryProps = {
  hnStory: HNStory;
  isShowing: boolean;
  flags: Flags;
};

export const Summary = ({ hnStory, isShowing }: SummaryProps) => {
  const { object, submit, isLoading } = useObject({
    api: "/api/generate",
    schema: messageSchema,
  });

  const submit2 = React.useCallback(submit, []);

  React.useEffect(() => {
    if (isShowing) {
      submit2(hnStory);
    }
  }, [isShowing, hnStory, submit2]);

  return (
    <span
      className="font-mono text-sm leading-6 italic"
      title={`Summary generated by OpenAI ${model} and may be inaccurate or incorrect.`}
    >
      {isLoading ? `${object?.summary || ""}.` : object?.summary}
    </span>
  );
};
